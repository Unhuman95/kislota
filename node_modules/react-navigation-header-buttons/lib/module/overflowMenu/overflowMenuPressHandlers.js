"use strict";

import { Platform, ActionSheetIOS, UIManager, findNodeHandle } from 'react-native';
import { HiddenItem } from "../HeaderItems.js";
import inspectElements from 'react-to-imperative';
export const extractOverflowButtonData = hiddenButtons => {
  return inspectElements(hiddenButtons, extractHiddenItemProps);
};
export const extractHiddenItemProps = ({
  props,
  type
}) => {
  if (type === HiddenItem) {
    return props;
  }
  return true;
};
export const overflowMenuPressHandlerActionSheet = ({
  hiddenButtons,
  cancelButtonLabel = 'Cancel'
}) => {
  let actionTitles = hiddenButtons.map(btn => btn.title);
  actionTitles.unshift(cancelButtonLabel);
  const disabledButtonIndices = (() => {
    let result = [];
    hiddenButtons.forEach((it, index) => {
      if (it.disabled) {
        result.push(index + 1);
      }
    });
    return result;
  })();
  const destructiveButtonIndex = (() => {
    let result = [];
    hiddenButtons.forEach((it, index) => {
      if (it.destructive) {
        result.push(index + 1);
      }
    });
    return result;
  })();
  ActionSheetIOS.showActionSheetWithOptions({
    options: actionTitles,
    cancelButtonIndex: 0,
    disabledButtonIndices,
    destructiveButtonIndex
  }, buttonIndex => {
    if (buttonIndex > 0) {
      hiddenButtons[buttonIndex - 1]?.onPress?.();
    }
  });
};
export const overflowMenuPressHandlerPopupMenu = ({
  hiddenButtons,
  overflowButtonRef
}) => {
  const enabledButtons = hiddenButtons.filter(it => it.disabled !== true);
  // @ts-expect-error TODO vonovak this was removed in RN 0.75
  const presenter = UIManager.showPopupMenu;
  const node = findNodeHandle(overflowButtonRef);
  if (!presenter || !node) {
    console.warn('could not present overflow menu using showPopupMenu(). This is only available on Android with RN <= 0.75. See https://github.com/vonovak/react-navigation-header-buttons/issues/252');
    return;
  }
  presenter(node, enabledButtons.map(btn => btn.title), () => console.debug('overflowBtn error'), (eventName, index) => {
    if (eventName !== 'itemSelected' || typeof index !== 'number') {
      return;
    }
    enabledButtons[index]?.onPress?.();
  });
};
export const overflowMenuPressHandlerDropdownMenu = ({
  children,
  overflowButtonRef,
  presentMenu
}) => {
  if (overflowButtonRef) {
    overflowButtonRef.measureInWindow((x, y, width) => {
      presentMenu({
        elements: children,
        x: x + width,
        y
      });
    });
  } else {
    console.error('overflowButtonRef is null, cannot show overflow menu');
  }
};
export const defaultOnOverflowMenuPress = Platform.select({
  ios: overflowMenuPressHandlerActionSheet,
  default: overflowMenuPressHandlerDropdownMenu
});
//# sourceMappingURL=overflowMenuPressHandlers.js.map